var FixiGridUI;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this.animatinoDuration=150,this.targetClass="",this.shadowClass="",this.axisX=a,this.scaleY=b,this.courtDict=c,this.behavior=d3.behavior.drag().on("dragstart",this.dragStart.bind(this)).on("drag",this.drag.bind(this)).on("dragend",this.dragEnd.bind(this))}return a.prototype.dragStart=function(){var a=$(event.srcElement).parent().get(0),b=$(a).clone();this.target=d3.select(a).classed(this.targetClass,!0),this.shadow=d3.select(b.get(0)).classed(this.shadowClass,!0),this.gameAria=this.shadow.select(".game-aria"),this.gameAriaHeightOriginal=parseInt(this.gameAria.attr("height")),this.rect=d3.transform(this.shadow.attr("transform")).translate,this.dragStartPageX=event.pageX,this.dragStartPageY=event.pageY,b.appendTo($(a).parent())},a.prototype.drag=function(a){},a.prototype.dragEnd=function(a){var b=this;setTimeout(function(){b.target.classed(b.targetClass,!1),b.shadow.remove();var c=d3.transform(b.shadow.attr("transform")).translate,d={left:c[0],top:c[1],width:parseFloat(b.shadow.select("rect.game-aria").attr("width")),height:parseFloat(b.shadow.select("rect.game-aria").attr("height"))};$(b).trigger("change",[d,b.target,a])},this.animatinoDuration)},a}();a.BaseDragBehavior=b}(b=a.Behaviors||(a.Behaviors={}))}(b=a.FixiGridComponents||(a.FixiGridComponents={}))}(FixiGridUI||(FixiGridUI={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},FixiGridUI;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.targetClass="dragged",this.shadowClass="shadow"}return __extends(b,a),b.prototype.drag=function(a){var b=event.pageX-this.dragStartPageX,c=this.courtDict()[a.courtId].size,d=this.rect[0]+b+c/2,e=d-d%c,f=event.pageY-this.dragStartPageY,g=this.scaleY.invert(this.rect[1]+f),h=this.axisX.ticks()[1];g.setMinutes(g.getMinutes()-g.getMinutes()%h,0);var i=this.scaleY(g);0>e||0>i||this.shadow.transition().duration(this.animatinoDuration).ease("sin-out").attr({transform:"translate("+e+","+i+")"})},b}(a.BaseDragBehavior);a.GameDragBehavior=b}(b=a.Behaviors||(a.Behaviors={}))}(b=a.FixiGridComponents||(a.FixiGridComponents={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.shadowClass="resize-shadow"}return __extends(b,a),b.prototype.drag=function(a){var b=event.pageY-this.dragStartPageY,c=this.scaleY.invert(b),d=this.axisX.ticks()[1];c.setMinutes(c.getMinutes()-c.getMinutes()%d,0);var e=this.scaleY(c);this.gameAriaHeightOriginal+e<0||this.gameAria.attr({height:this.gameAriaHeightOriginal+e})},b}(a.BaseDragBehavior);a.GameResizeDownBehavior=b}(b=a.Behaviors||(a.Behaviors={}))}(b=a.FixiGridComponents||(a.FixiGridComponents={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.shadowClass="resize-shadow"}return __extends(b,a),b.prototype.drag=function(a){var b=event.pageY-this.dragStartPageY,c=this.scaleY.invert(this.rect[1]+b),d=this.axisX.ticks()[1];c.setMinutes(c.getMinutes()-c.getMinutes()%d,0);var e=this.scaleY(c);0>e&&this.rect[1]-e>0||(this.shadow.attr({transform:"translate("+this.rect[0]+","+e+")"}),this.gameAria.attr({height:this.gameAriaHeightOriginal+(this.rect[1]-e)}))},b}(a.BaseDragBehavior);a.GameResizeTopBehavior=b}(b=a.Behaviors||(a.Behaviors={}))}(b=a.FixiGridComponents||(a.FixiGridComponents={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(){}return b.render=function(b,c){var d=b.selectAll(".game").data(c);d.exit().remove(),d.enter().append("g").classed("game",!0);var e=d.selectAll(".game-aria").data(function(a){return[a]});e.exit().remove(),e.enter().append("rect").classed("game-aria",!0).on("click",function(a){$(d).trigger("ongameclick",[a,"edit"])}).on("mouseover",function(a,b,c){d3.select(event.target).classed("f-hover",!0)}).on("mouseleave",function(a,b,c){d3.select(event.target).classed("f-hover",!1)});var f=d.selectAll(".game-aria-resize-top").data(function(a){return[a]});f.exit().remove(),f.enter().append("rect").classed("game-aria-resize-top",!0);d.selectAll(".game-aria-resize-down").data(function(a){return[a]});f.exit().remove(),f.enter().append("rect").classed("game-aria-resize-down",!0);var g=d.selectAll(".game-color").data(function(a){return[a]});g.exit().remove(),g.enter().append("rect").classed("game-color",!0);var h=d.selectAll(".game-title-1").data(function(a){return[a]});h.exit().remove(),h.enter().append("g").classed("game-title-1",!0);var i=h.selectAll(".title").data(function(a){return[a]});i.exit().remove(),i.enter().append("text").classed("title",!0);var j=h.selectAll(".remove").data(function(a){return[a]});j.exit().remove(),j.enter().append("text").classed("remove",!0).attr({"data-role":"button"}).on("click",function(a){$(d).trigger("ongameclick",[a,"remove"])});var k=d.selectAll(".description").data(function(a){return[a]});k.exit().remove(),k.enter().append("g").classed("description",!0);var l=k.selectAll("text").data(function(b){var c=[];return b.division&&c.push(b.division),c.push(a.Utils.toTimeString(b.from)+" - "+a.Utils.toTimeString(b.to)),c});return l.exit().remove(),l.enter().append("text"),d},b.reposition=function(a,b,c){var d=a.selectAll(".game").attr({transform:function(a){return"translate("+c[a.courtId].position+","+b(a.from)+")"}});d.selectAll("rect.game-aria").attr({width:function(a){return c[a.courtId].size-4},height:function(a){return b(a.to)-b(a.from)}}),d.selectAll(".game-aria-resize-top").attr({width:function(a){return c[a.courtId].size-4},height:10}),d.selectAll(".game-aria-resize-down").attr({width:function(a){return c[a.courtId].size-4},height:10,y:function(a){return b(a.to)-b(a.from)-10}}),d.selectAll("rect.game-color").attr({x:function(a){return 4},width:10,y:function(a){return 3},height:function(a){return b(a.to)-b(a.from)-5}}).style({fill:function(a){return c[a.courtId].color}}),d.selectAll("text.title").attr({dy:"14px",x:function(a){return c[a.courtId].size/2}}).text(function(a){return a.user}),d.selectAll("text.remove").attr({dx:"-15px",dy:13,x:function(a){return c[a.courtId].size}}).text("x"),d.selectAll(".description").attr({transform:function(a,b){return"translate("+c[a.courtId].size/2+",0)"}}),d.selectAll(".description text").attr({dy:25,dx:5,transform:function(a,b){return"translate(0,"+10*b+")"}}).style({"text-anchor":"middle"}).text(function(a){return a})},b}();b.Game=c}(c=b.Elements||(b.Elements={}))}(b=a.FixiGridComponents||(a.FixiGridComponents={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(a){var b=function(){function b(b){var c=this;this.scale={x:null,y:null},this._courtDict={},this._courts=[],this._games=[],this.axis={x:d3.svg.axis(),y:d3.svg.axis()},this.d3svgcontent=b.d3Container.classed("games",!0),this.scale.x=b.scaleX,this.scale.y=b.scaleY,this.axis.x.orient("top").scale(this.scale.x).tickFormat(""),this.axis.y.orient("left").scale(this.scale.y).ticks(d3.time.minute,15).tickFormat(""),this.gameDragBehavior=new a.Behaviors.GameDragBehavior(this.axis.y,this.scale.y,function(){return c.courtDict}),this.gameResizeTopBehavior=new a.Behaviors.GameResizeTopBehavior(this.axis.y,this.scale.y,function(){return c.courtDict}),this.gameResizeDownBehavior=new a.Behaviors.GameResizeDownBehavior(this.axis.y,this.scale.y,function(){return c.courtDict}),$([this.gameDragBehavior,this.gameResizeTopBehavior,this.gameResizeDownBehavior]).on("change",function(a,b,d,e){$(c).trigger("ongamechange",{data:e,unitCell:c.scale.x.invert(b.left),from:c.scale.y.invert(b.top),to:c.scale.y.invert(b.top+b.height)})}),this.gridRender()}return Object.defineProperty(b.prototype,"courtDict",{get:function(){return this._courtDict},set:function(a){this._courtDict=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"courts",{get:function(){return this._courts},set:function(a){this._courts=a,this.gridReposition()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"games",{get:function(){return this._games},set:function(b){var c=this;this._games=b;var d=a.Elements.Game.render(this.d3svgcontent,this._games);$(d).on("ongameclick",function(a,b,d){$(c).trigger("ongameclick",{data:b,type:d})}),d.selectAll(".game-aria").call(this.gameDragBehavior.behavior),d.selectAll(".game-aria-resize-top").call(this.gameResizeTopBehavior.behavior),d.selectAll(".game-aria-resize-down").call(this.gameResizeDownBehavior.behavior),this.reposition()},enumerable:!0,configurable:!0}),b.prototype.render=function(a,b){this.courts=a,this.games=b},b.prototype.reposition=function(){this.gridReposition(),a.Elements.Game.reposition(this.d3svgcontent,this.scale.y,this.courtDict)},b.prototype.gridRender=function(){this.d3svgcontent.append("g").classed("axis-x",!0),this.d3svgcontent.append("g").classed("axis-y",!0)},b.prototype.gridReposition=function(){this.courtDict={};for(var a=0,b=this.courts.length;b>a;a++)for(var c=this.courts[a],d=0,e=c.length;e>d;d++){var f=c[d];this.courtDict[f.CourtId]={color:f.Color,position:this.scale.x(f.ColSpan)*d,size:this.scale.x(f.ColSpan)}}this.axis.x.tickSize(-this.scale.y.range()[1],1),this.axis.y.tickSize(-this.scale.x.range()[1],1),this.d3svgcontent.select("g.axis-x").call(this.axis.x),this.d3svgcontent.select("g.axis-y").call(this.axis.y)},b}();a.Content=b}(b=a.FixiGridComponents||(a.FixiGridComponents={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(b){var c=function(){function b(a){var b=this;this.fixiGridSize={width:0,height:0},this.scale=d3.scale.linear(),this.courtMetrikRegistry={},this.render=function(){var a=b.countHeader.selectAll("g").data(b.courts);a.exit().remove();var c=a.enter().append("g").classed("court-type",!0),d=c.selectAll(".court").data(function(a){return a});d.exit().remove();var e=d.enter().append("g").classed("court",!0).attr({"data-id":function(a){return a.CourtId},"data-colspan":function(a){return a.ColSpan}});e.append("text").classed("court-title",!0).attr({dy:"-1em"}).text(function(a){return a.CourtName}),e.append("line").classed("court-line-1",!0).attr({stroke:"silver",opacity:.2}),e.append("line").classed("court-line-2",!0).attr({stroke:"black",opacity:.125}),e.append("line").classed("court-line-3",!0).attr({stroke:"black",opacity:.125}),b.reposition()},this.options=a,this.countHeader=a.d3Container.append("g").classed("court-header",!0)}return Object.defineProperty(b.prototype,"height",{get:function(){return 30*this.courtLevelCount},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"courtLevelCount",{get:function(){return this.courts.length},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sectionWidth",{get:function(){return this.scale(1)},enumerable:!0,configurable:!0}),b.prototype.refreshSize=function(a){this.fixiGridSize.width=a.width,this.fixiGridSize.height=a.height,this.scale.range([0,a.width-a.timeLineWidth]),this.reposition()},b.prototype.setCourts=function(b){var c=a.Utils.groupBy(b,"ColSpan"),d=0,e=[];for(var f in c)d=d>c[f].length?d:c[f].length,e.push(c[f]);this.scale.domain([0,d]),this.courts=e,this.render()},b.prototype.reposition=function(){var a=this,b=this.countHeader.selectAll(".court-type").attr({transform:function(a,b){return"translate(0,"+30*b+")"}}),c=b.selectAll(".court");c.attr({transform:function(b,c){return"translate("+a.scale(b.ColSpan)*c+",0)"}}),c.selectAll(".court-title").attr({dx:function(b,c){return a.scale(b.ColSpan)/2}}),c.selectAll(".court-line-2").attr({x1:function(b,c,d){return a.scale(b.ColSpan)},x2:function(b,c,d){return a.scale(b.ColSpan)},y1:0,y2:-30}),c.selectAll(".court-line-3").attr({x1:0,x2:function(b){return a.scale(b.ColSpan)},y1:0,y2:0})},b.prototype.convertUnitCellToCourt=function(a,b){var c=this.countHeader.select("[data-id='"+a.courtId+"']").data()[0],d=this.countHeader.selectAll("[data-colspan='"+c.ColSpan+"']").data(),e=parseInt((b/c.ColSpan).toFixed(0));return d[e]},b}();b.FixiGridHeader=c}(b=a.FixiGridComponents||(a.FixiGridComponents={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(a){var b=function(){function a(a){this.scale=d3.time.scale(),this.axis=d3.svg.axis(),this.tickCount=0,this.fixiGridSize={width:0,height:0},this.args=a,this.axis.orient("left").scale(this.scale).ticks(d3.time.hour,1).tickPadding(-65).tickFormat(d3.time.format("%I %p")),this.args.d3Container.append("rect").classed("TimeLine-back",!0)}return a.prototype.setDate=function(a,b){a>b||(this.scale.domain([a,b]),this.tickCount=(b.getTime()-a.getTime())/1e3/60/60,this.render())},a.prototype.render=function(){this.args.d3Container.append("g").classed("TimeLine",!0),this.reposition()},a.prototype.refreshSize=function(a){this.fixiGridSize.width=a.width,this.fixiGridSize.height=a.width,this.axis.tickSize(a.timeLineWidth,1),this.scale.range([0,80*this.tickCount]),this.reposition()},a.prototype.reposition=function(){var a=this.args.d3Container.select(".TimeLine");a.call(this.axis),this.args.d3Container.select(".TimeLine-back").attr({x:-90,width:90,height:this.fixiGridSize.height}).style({fill:"#fafafa"}),a.selectAll("text").attr({dy:18})},a}();a.TimeLine=b}(b=a.FixiGridComponents||(a.FixiGridComponents={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(a){a.grid='<style>    g.tick line { stroke: #ddd; stroke-width: 1px; fill: aquamarine; }    .courtAxis g text { text-anchor: start !important; }</style><div>    <svg shape-rendering="crispEdges" class="FixiGridHeader" style="width:100%;height: 90px;background:#fafafa">           </svg>    <div class="fixiGridContentScroll" style="">        <svg shape-rendering="crispEdges" class="fixiGridContent" style="width:100%;">                   </svg>    </div></div>'}(b=a.Markup||(a.Markup={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(a){a.print='<!DOCTYPE html><html><head>    <meta charset="utf-8" />    <meta name="viewport" content="width=device-width" />    <link href="Scripts/fixi.grid/style/fixiGrid.css" rel="stylesheet" />    <link href="Scripts/fixi.grid/style/fixiGrid.print.css" rel="stylesheet" />    <style>        g.tick line { stroke: #ddd; stroke-width: 1px; fill: aquamarine; }        .courtAxis g text { text-anchor: start !important; }    </style></head><body>     <div id="fixiGrid">          </div></body></html>'}(b=a.Markup||(a.Markup={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(b){var c=function(){function b(b){this.uiMarkup=b,this.header=new a.FixiGridComponents.FixiGridHeader({d3Container:b.d3HeaderComponentContainer}),this.timeLine=new a.FixiGridComponents.TimeLine({d3Container:b.d3ContentComponentContainer}),this.content=new a.FixiGridComponents.Content({d3Container:b.d3TimeLineComponentContainer,scaleX:this.header.scale,scaleY:this.timeLine.scale})}return Object.defineProperty(b.prototype,"onGameClickHandler",{set:function(a){$(this.content).on("ongameclick",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onGameChangeHandler",{set:function(a){$(this.content).on("ongamechange",a)},enumerable:!0,configurable:!0}),b}();b.Components=c}(b=a.Models||(a.Models={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(b){var c=function(){function b(b){var c=this;this.print=function(){setTimeout(function(){var b=document.createElement("iframe"),d=$("<html>");d.html(a.Markup.print),d.find("#fixiGrid").append(c.uiMarkup.$container.clone()),$(window.document.body).append(b),b.contentWindow.document.writeln(d.html()),setTimeout(function(){b.contentDocument.execCommand("print",!1,null),b.parentNode.removeChild(b)},250)},200)}}return b}();b.Printer=c}(b=a.Models||(a.Models={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(b){var c=function(){function b(b){this.cssClasses={header:"fixiGridHeader",content:"fixiGridContent"},this.config={width:0,height:0,timeLineWidth:90},this.$container=$(document.getElementById(b)),this.$element=this.$container.append(a.Markup.grid),this.d3HeaderComponentContainer=this.d3HeaderSelection.append("g").attr({transform:"translate("+this.config.timeLineWidth+",30)"}),this.d3ContentComponentContainer=this.d3ContentSelection.append("g").attr({transform:"translate("+this.config.timeLineWidth+",1)"}),this.d3TimeLineComponentContainer=this.d3ContentSelection.append("g").attr({transform:"translate("+this.config.timeLineWidth+",1)"})}return Object.defineProperty(b.prototype,"$element",{get:function(){return this._$element},set:function(b){this._$element=b,this.headerNode=a.Utils.getNodesByClassName(this.$element,this.cssClasses.header).item(0),this.d3HeaderSelection=d3.select(this.headerNode),this.contentNode=a.Utils.getNodesByClassName(this.$element,this.cssClasses.content).item(0),this.d3ContentSelection=d3.select(this.contentNode)},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){this.$container.off(),this.$container.empty()},b.prototype.refreshSizeConfiguration=function(){return this.config.width=this.$container.width()-25,this.config.height=this.$container.height(),this.config},b}();b.UIMarkup=c}(b=a.Models||(a.Models={}))}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b=function(){function b(b){var c=this;this.config=b,this.destroy=function(){$(window).off("resize.fixiGrid"),c.uiMarkup.dispose()},this.uiMarkup=new a.Models.UIMarkup(b.id),this.printer=new a.Models.Printer(this.uiMarkup),this.components=new a.Models.Components(this.uiMarkup),this.subscribe()}return b.prototype.setData=function(a){this.components.content.render(this.components.header.courts,a.games)},b.prototype.setCourt=function(a,b,c){this.components.header.setCourts(a),this.components.timeLine.setDate(b,c),this.refreshSize()},b.prototype.subscribe=function(){var a=this;this.components.onGameClickHandler=function(b,c){switch(c.type){case"remove":a.config.event&&a.config.event.onRemove&&a.config.event.onRemove(c.data,b);break;case"edit":a.config.event&&a.config.event.onOpen&&a.config.event.onOpen(c.data,b)}},this.components.onGameChangeHandler=function(b,c){var d=a.components.header.convertUnitCellToCourt(c.data,c.unitCell);a.config.event&&a.config.event.onChange&&a.config.event.onChange(c.data,d,c.from,c.to)},$(window).on("resize.fixiGrid",function(){a.refreshSize()})},b.prototype.refreshSize=function(){var a=this.uiMarkup.refreshSizeConfiguration();this.components.header.refreshSize(a),this.components.timeLine.refreshSize(a),this.components.content.reposition(),this.uiMarkup.d3ContentSelection.attr({height:this.components.timeLine.scale.range()[1]})},b}();a.Grid=b}(FixiGridUI||(FixiGridUI={}));var FixiGridUI;!function(a){var b;!function(a){function b(a,b){var c={};return a.forEach(function(a){c[a[b]]||(c[a[b]]=[]),c[a[b]].push(a)}),c}function c(a){var b=a.getHours(),c="AM";b>12&&(b-=12,c="PM");var d=a.getMinutes().toString();return 1==d.length&&(d="0"+d),b+":"+d+" "+c}function d(a,b){return a.get(0).getElementsByClassName(b)}a.groupBy=b,a.toTimeString=c,a.getNodesByClassName=d}(b=a.Utils||(a.Utils={}))}(FixiGridUI||(FixiGridUI={}));