var fixiGridComponents;!function(a){var b;!function(a){var b=function(){function a(a,b,c){this.animatinoDuration=150,this.axisX=a,this.scaleY=b,this.courtDict=c,this.behavior=d3.behavior.drag().on("dragstart",this.dragStart.bind(this)).on("drag",this.drag.bind(this)).on("dragend",this.dragEnd.bind(this))}return a.prototype.dragStart=function(){var a=$(event.srcElement).parent().get(0),b=$(a).clone();this.target=d3.select(a).classed("dragged",!0),this.shadow=d3.select(b.get(0)).classed("shadow",!0),this.rect=d3.transform(this.shadow.attr("transform")).translate,this.dragStartPageX=event.pageX,this.dragStartPageY=event.pageY,b.appendTo($(a).parent())},a.prototype.drag=function(a){},a.prototype.dragEnd=function(a){var b=this;setTimeout(function(){b.target.classed("dragged",!1),b.shadow.remove(),$(b).trigger("change",[d3.transform(b.shadow.attr("transform")).translate,b.target,a])},this.animatinoDuration)},a}();a.baseDragBehavior=b}(b=a.behaviors||(a.behaviors={}))}(fixiGridComponents||(fixiGridComponents={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},fixiGridComponents;!function(a){var b;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.drag=function(a){var b=event.pageX-this.dragStartPageX,c=this.courtDict()[a.courtId].size,d=this.rect[0]+b+c/2,e=d-d%c,f=event.pageY-this.dragStartPageY,g=this.scaleY.invert(this.rect[1]+f),h=this.axisX.ticks()[1];g.setMinutes(g.getMinutes()-g.getMinutes()%h,0);var i=this.scaleY(g);0>e||0>i||this.shadow.transition().duration(this.animatinoDuration).ease("sin-out").attr({transform:"translate("+e+","+i+")"})},b}(a.baseDragBehavior);a.gameDragBehavior=b}(b=a.behaviors||(a.behaviors={}))}(fixiGridComponents||(fixiGridComponents={}));var fixiGridComponents;!function(a){var b;!function(a){var b=function(){function a(){}return a.render=function(a,b){var c=a.selectAll(".game").data(b);c.exit().remove(),c.enter().append("g").classed("game",!0);var d=c.selectAll(".game-aria").data(function(a){return[a]});d.exit().remove(),d.enter().append("rect").classed("game-aria",!0).on("click",function(a){$(c).trigger("ongameclick",[a,"edit"])}).on("mouseover",function(a,b,c){d3.select(event.target).classed("f-hover",!0)}).on("mouseleave",function(a,b,c){d3.select(event.target).classed("f-hover",!1)});var e=c.selectAll(".game-aria-resize-top").data(function(a){return[a]});e.exit().remove(),e.enter().append("rect").classed("game-aria-resize-top",!0);c.selectAll(".game-aria-resize-down").data(function(a){return[a]});e.exit().remove(),e.enter().append("rect").classed("game-aria-resize-down",!0);var f=c.selectAll(".game-color").data(function(a){return[a]});f.exit().remove(),f.enter().append("rect").classed("game-color",!0);var g=c.selectAll(".game-title-1").data(function(a){return[a]});g.exit().remove(),g.enter().append("g").classed("game-title-1",!0);var h=g.selectAll(".title").data(function(a){return[a]});h.exit().remove(),h.enter().append("text").classed("title",!0);var i=g.selectAll(".remove").data(function(a){return[a]});i.exit().remove(),i.enter().append("text").classed("remove",!0).attr({"data-role":"button"}).on("click",function(a){$(c).trigger("ongameclick",[a,"remove"])});var j=c.selectAll(".description").data(function(a){return[a]});j.exit().remove(),j.enter().append("g").classed("description",!0);var k=j.selectAll("text").data(function(a){var b=[];return a.division&&b.push(a.division),b.push(fixiGridUtils.toTimeString(a.from)+" - "+fixiGridUtils.toTimeString(a.to)),b});return k.exit().remove(),k.enter().append("text"),c},a.reposition=function(a,b,c){var d=a.selectAll(".game").attr({transform:function(a){return"translate("+c[a.courtId].position+","+b(a.from)+")"}});d.selectAll("rect.game-aria").attr({width:function(a){return c[a.courtId].size-4},height:function(a){return b(a.to)-b(a.from)}}),d.selectAll(".game-aria-resize-top").attr({width:function(a){return c[a.courtId].size-4},height:10}),d.selectAll(".game-aria-resize-down").attr({width:function(a){return c[a.courtId].size-4},height:10,y:function(a){return b(a.to)-b(a.from)-10}}),d.selectAll("rect.game-color").attr({x:function(a){return 4},width:10,y:function(a){return 3},height:function(a){return b(a.to)-b(a.from)-5}}).style({fill:function(a){return c[a.courtId].color}}),d.selectAll("text.title").attr({dy:"14px",x:function(a){return c[a.courtId].size/2}}).text(function(a){return a.user}),d.selectAll("text.remove").attr({dx:"-15px",dy:13,x:function(a){return c[a.courtId].size}}).text("x"),d.selectAll(".description").attr({transform:function(a,b){return"translate("+c[a.courtId].size/2+",0)"}}),d.selectAll(".description text").attr({dy:25,dx:5,transform:function(a,b){return"translate(0,"+10*b+")"}}).style({"text-anchor":"middle"}).text(function(a){return a})},a}();a.game=b}(b=a.elements||(a.elements={}))}(fixiGridComponents||(fixiGridComponents={}));var fixiGridComponents;!function(a){var b=function(){function b(b){var c=this;this.scale={x:null,y:null},this._courtDict={},this._courts=[],this._games=[],this.axis={x:d3.svg.axis(),y:d3.svg.axis()},this.d3svgcontent=b.d3Container.classed("games",!0),this.scale.x=b.scaleX,this.scale.y=b.scaleY,this.axis.x.orient("top").scale(this.scale.x).tickFormat(""),this.axis.y.orient("left").scale(this.scale.y).ticks(d3.time.minute,15).tickFormat(""),this.gameDragBehavior=new a.behaviors.gameDragBehavior(this.axis.y,this.scale.y,function(){return c.courtDict}),this.gameResizeTopBehavior=new a.behaviors.gameResizeTopBehavior(this.axis.y,this.scale.y,function(){return c.courtDict}),$(this.gameDragBehavior).on("change",function(a,b,d,e){var f=c.scale.x.invert(b[0]),g=c.scale.y.invert(b[1]),h=c.scale.y.invert(b[1]+parseInt(d.selectAll(".game-aria").attr("height")));$(c).trigger("ongamechange",[e,f,g,h])}),this.gridRender()}return Object.defineProperty(b.prototype,"courtDict",{get:function(){return this._courtDict},set:function(a){this._courtDict=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"courts",{get:function(){return this._courts},set:function(a){this._courts=a,this.gridReposition()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"games",{get:function(){return this._games},set:function(b){var c=this;this._games=b;var d=a.elements.game.render(this.d3svgcontent,this._games);$(d).on("ongameclick",function(a,b,d){$(c).trigger("ongameclick",[b,d])}),d.selectAll(".game-aria").call(this.gameDragBehavior.behavior),d.selectAll(".game-aria-resize-top").call(this.gameResizeTopBehavior.behavior),this.reposition()},enumerable:!0,configurable:!0}),b.prototype.render=function(a,b){this.courts=a,this.games=b},b.prototype.reposition=function(){this.gridReposition(),a.elements.game.reposition(this.d3svgcontent,this.scale.y,this.courtDict)},b.prototype.gridRender=function(){this.d3svgcontent.append("g").classed("axis-x",!0),this.d3svgcontent.append("g").classed("axis-y",!0)},b.prototype.gridReposition=function(){this.courtDict={};for(var a=0,b=this.courts.length;b>a;a++)for(var c=this.courts[a],d=0,e=c.length;e>d;d++){var f=c[d];this.courtDict[f.CourtId]={color:f.Color,position:this.scale.x(f.ColSpan)*d,size:this.scale.x(f.ColSpan)}}this.axis.x.tickSize(-this.scale.y.range()[1],1),this.axis.y.tickSize(-this.scale.x.range()[1],1),this.d3svgcontent.select("g.axis-x").call(this.axis.x),this.d3svgcontent.select("g.axis-y").call(this.axis.y)},b}();a.content=b}(fixiGridComponents||(fixiGridComponents={}));var fixiGridComponents;!function(a){var b=function(){function a(a){var b=this;this.fixiGridSize={width:0,height:0},this.scale=d3.scale.linear(),this.courtMetrikRegistry={},this.render=function(){var a=b.countHeader.selectAll("g").data(b.courts);a.exit().remove();var c=a.enter().append("g").classed("court-type",!0),d=c.selectAll(".court").data(function(a){return a});d.exit().remove();var e=d.enter().append("g").classed("court",!0).attr({"data-id":function(a){return a.CourtId},"data-colspan":function(a){return a.ColSpan}});e.append("text").classed("court-title",!0).attr({dy:"-1em"}).text(function(a){return a.CourtName}),e.append("line").classed("court-line-1",!0).attr({stroke:"silver",opacity:.2}),e.append("line").classed("court-line-2",!0).attr({stroke:"black",opacity:.125}),e.append("line").classed("court-line-3",!0).attr({stroke:"black",opacity:.125}),b.reposition()},this.options=a,this.countHeader=a.d3Container.append("g").classed("court-header",!0)}return Object.defineProperty(a.prototype,"height",{get:function(){return 30*this.courtLevelCount},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"courtLevelCount",{get:function(){return this.courts.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sectionWidth",{get:function(){return this.scale(1)},enumerable:!0,configurable:!0}),a.prototype.refreshSize=function(a,b){this.fixiGridSize.width=a,this.fixiGridSize.height=a,this.scale.range([0,a-90]),this.reposition()},a.prototype.setCourts=function(a){var b=fixiGridUtils.groupBy(a,"ColSpan"),c=0,d=[];for(var e in b)c=c>b[e].length?c:b[e].length,d.push(b[e]);this.scale.domain([0,c]),this.courts=d,this.render()},a.prototype.reposition=function(){var a=this,b=this.countHeader.selectAll(".court-type").attr({transform:function(a,b){return"translate(0,"+30*b+")"}}),c=b.selectAll(".court");c.attr({transform:function(b,c){return"translate("+a.scale(b.ColSpan)*c+",0)"}}),c.selectAll(".court-title").attr({dx:function(b,c){return a.scale(b.ColSpan)/2}}),c.selectAll(".court-line-2").attr({x1:function(b,c,d){return a.scale(b.ColSpan)},x2:function(b,c,d){return a.scale(b.ColSpan)},y1:0,y2:-30}),c.selectAll(".court-line-3").attr({x1:0,x2:function(b){return a.scale(b.ColSpan)},y1:0,y2:0})},a.prototype.convertUnitCellToCourt=function(a,b){var c=this.countHeader.select("[data-id='"+a.courtId+"']").data()[0],d=this.countHeader.selectAll("[data-colspan='"+c.ColSpan+"']").data(),e=parseInt((b/c.ColSpan).toFixed(0));return d[e]},a}();a.fixiGridHeader=b}(fixiGridComponents||(fixiGridComponents={}));var fixiGridComponents;!function(a){var b=function(){function a(a){this.scale=d3.time.scale(),this.axis=d3.svg.axis(),this.tickCount=0,this.fixiGridSize={width:0,height:0},this.args=a,this.axis.orient("left").scale(this.scale).ticks(d3.time.hour,1).tickPadding(-65).tickFormat(d3.time.format("%I %p")),this.args.d3Container.append("rect").classed("timeline-back",!0)}return a.prototype.setDate=function(a,b){a>b||(this.scale.domain([a,b]),this.tickCount=(b.getTime()-a.getTime())/1e3/60/60,this.render())},a.prototype.render=function(){this.args.d3Container.append("g").classed("timeLine",!0),this.reposition()},a.prototype.refreshSize=function(a,b){this.fixiGridSize.width=a,this.fixiGridSize.height=a,this.axis.tickSize(90,1),this.scale.range([0,80*this.tickCount]),this.reposition()},a.prototype.reposition=function(){var a=this.args.d3Container.select(".timeLine");a.call(this.axis),this.args.d3Container.select(".timeline-back").attr({x:-90,width:90,height:this.fixiGridSize.height}).style({fill:"#fafafa"}),a.selectAll("text").attr({dy:18})},a}();a.timeLine=b}(fixiGridComponents||(fixiGridComponents={}));var fixiGridTemplates;!function(a){a.grid='<style>    g.tick line { stroke: #ddd; stroke-width: 1px; fill: aquamarine; }    .courtAxis g text { text-anchor: start !important; }</style><div>    <svg shape-rendering="crispEdges" class="fixiGridHeader" style="width:100%;height: 90px;background:#fafafa">           </svg>    <div style="overflow: auto;position: absolute;top: 90px;left: 0;right: 0;bottom: 0;border-top: 1px solid #ddd;">        <svg shape-rendering="crispEdges" class="fixiGridContent" style="width:100%;">                   </svg>    </div></div>'}(fixiGridTemplates||(fixiGridTemplates={}));var fixiGrid=function(){function a(a){var b=this;this.config={width:0,height:0,timeLineWidth:90},this.components={header:null,timeLine:null,content:null},this.destroy=function(){$(window).off("resize.fixiGrid"),b.container.off("*"),b.container.empty()},this.container=$("#"+a.id),this.element=this.container.append(fixiGridTemplates.grid),this.d3svgheader=d3.select("#"+a.id+" .fixiGridHeader"),this.d3svgcontent=d3.select("#"+a.id+" .fixiGridContent"),this.components.header=new fixiGridComponents.fixiGridHeader({d3Container:this.d3svgheader.append("g").attr({transform:"translate("+this.config.timeLineWidth+",30)"})}),this.components.timeLine=new fixiGridComponents.timeLine({d3Container:this.d3svgcontent.append("g").attr({transform:"translate("+this.config.timeLineWidth+",1)"})}),this.components.content=new fixiGridComponents.content({d3Container:this.d3svgcontent.append("g").attr({transform:"translate("+this.config.timeLineWidth+",1)"}),scaleX:this.components.header.scale,scaleY:this.components.timeLine.scale}),$(this.components.content).on("ongameclick",function(b,c,d){"remove"==d&&a.event&&a.event.onRemove&&a.event.onRemove(c,b),"edit"==d&&a.event&&a.event.onOpen&&a.event.onOpen(c,b)}),$(this.components.content).on("ongamechange",function(c,d,e,f,g){var h=b.components.header.convertUnitCellToCourt(d,e);a.event&&a.event.onChange&&a.event.onChange(d,h,f,g)}),$(window).on("resize.fixiGrid",function(){b.refreshSize()})}return a.prototype.setData=function(a){this.components.content.render(this.components.header.courts,a.games)},a.prototype.setCourt=function(a,b,c){this.components.header.setCourts(a),this.components.timeLine.setDate(b,c),this.refreshSize()},a.prototype.refreshSize=function(){this.config.width=this.container.width()-25,this.config.height=this.container.height(),this.components.header.refreshSize(this.config.width,this.config.height),this.components.timeLine.refreshSize(this.config.width,this.config.height),this.components.content.reposition(),this.d3svgcontent.attr({height:this.components.timeLine.scale.range()[1]})},a}(),fixiGridUtils;!function(a){function b(a,b){var c={};return a.forEach(function(a){c[a[b]]||(c[a[b]]=[]),c[a[b]].push(a)}),c}function c(a){var b=a.getHours(),c="AM";b>12&&(b-=12,c="PM");var d=a.getMinutes().toString();return 1==d.length&&(d="0"+d),b+":"+d+" "+c}a.groupBy=b,a.toTimeString=c}(fixiGridUtils||(fixiGridUtils={}));